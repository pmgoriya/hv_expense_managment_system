# API Documentation

| Endpoint | HTTP Method | Purpose | Role Access | Request Payload | Response | Schema Tables | Notes |
|----------|-------------|---------|------------|-----------------|----------|---------------|-------|
| `/api/login` | POST | Authenticate users via Google OAuth | All | `{code}` (Google OAuth token) | 200: `{jwt, user_id, role_id}`<br>401: Unauthorized | users | Requires @humanventures email. JWT for subsequent requests. |
| `/api/logout` | POST | Invalidate JWT session | All | None | 200: Success | None | Ensures secure session termination. Requires JWT. |
| `/api/profile` | GET | Retrieve logged-in user's details | All | None | 200: `{first_name, last_name, email, department_id, role_id}`<br>403: Unauthenticated | users, departments, roles | Supports UI context (e.g., dashboard permissions). Requires JWT. |
| `/api/reimbursements` | POST | Create a reimbursement request | Employee, Manager, Approver | `{expense_date, cost_category_id, purpose_id, description, amount, ref_bill_number, bill_attached}` (multipart) | 201: `{id, status: "Pending"}`<br>400: Invalid data<br>403: Unauthenticated | reimbursement_requests, request_updates | Creates request_updates entry (status_id=1, updated_by_id=NULL). bill_attached as file. Authenticated user's employee_id. |
| `/api/reimbursements` | GET | List reimbursement requests | All, Manager, Approver | None | 200: `[{id, expense_date, cost_category_name, purpose_name, description, amount, ref_bill_number, status_name, updated_by_email, updated_at}]`<br>403: Unauthorized | reimbursement_requests, request_updates, cost_categories, purposes, statuses, users | Query params: `scope=me` |
| `/api/reimbursements/{id}/updates` | POST | Approve or reject a reimbursement request | Manager, Approver | `{status_id, reason}` (reason required if status=Rejected) | 200: `{status: "ManagerApproved"}`<br>400: Invalid status<br>403: Unauthorized | request_updates, statuses, users | Manager: Pending → ManagerApproved/Rejected. Approver: ManagerApproved → FinalApproved/Rejected. Sets updated_by_id. Reason NULL unless Rejected. |
| `/api/reimbursements/{id}/pay` | POST | Mark reimbursement as Paid | Approver | None | 200: `{status: "Paid"}`<br>403: Unauthorized | request_updates, advance_balances | Creates request_updates (status_id=5, updated_by_id=Approver). Adjusts advance_balances if offset applies. |
| `/api/advances` | POST | Create an advance request | Employee, Manager, Approver | `{request_date, start_date, end_date, cost_category_id, purpose_id, description, amount}` | 201: `{id, status: "Pending"}`<br>400: Invalid data<br>403: Unauthenticated | advance_requests, request_updates | Creates request_updates (status_id=1, updated_by_id=NULL). Authenticated user's employee_id. |
| `/api/advances` | GET | List advance requests | All, Manager, Approver | None | 200: `[{id, request_date, start_date, end_date, cost_category_name, purpose_name, description, amount, status_name, updated_by_email, updated_at}]`<br>403: Unauthorized | advance_requests, request_updates, cost_categories, purposes, statuses, users | Query params: `scope=me` |
| `/api/advances/{id}/updates` | POST | Approve or reject an advance request | Manager, Approver | `{status_id, reason}` (reason if Rejected) | 200: `{status: "ManagerApproved"}`<br>400: Invalid status<br>403: Unauthorized | request_updates, statuses, users | Manager: Pending → ManagerApproved/Rejected. Approver: ManagerApproved → FinalApproved/Rejected. Sets updated_by_id. |
| `/api/advances/{id}/disburse` | POST | Mark advance as Disbursed | Approver | None | 200: `{status: "Disbursed"}`<br>403: Unauthorized | request_updates, advance_balances | Creates request_updates (status_id=6, updated_by_id=Approver). Updates advance_balances. |
| `/api/balances` | GET | Retrieve advance balances | All, Manager, Approver | None | 200: `[{employee_id, first_name, last_name, balance}]`<br>403: Unauthorized | advance_balances, users | Query params: `scope=me` |
| `/api/dashboard` | GET | Retrieve dashboard metrics | All, Manager, Approver | None | 200: `{pending_reimbursements: N, pending_advances: M, team_pending: N, manager_approved: N, advance_balance: X}`<br>403: Unauthorized | reimbursement_requests, advance_requests, request_updates, advance_balances, users | Query params: `scope=me` |
| `/api/cost-categories` | GET | List available cost categories | All | None | 200: `[{id, name}]` | cost_categories | Returns Product, Office Travel, Others. Used for form dropdowns. No auth required for simplicity (public data). |
| `/api/purposes` | GET | List purposes, filterable by category | All | None | 200: `[{id, name, cost_category_id}]` | purposes | Query param: cost_category_id (e.g., filter for Product → Purchase, Porter). Supports dynamic forms. No auth required. |
| `/api/statuses` | GET | List valid request statuses | All | None | 200: `[{id, name, is_reimbursement, is_advance}]` | statuses | Returns Pending, ManagerApproved, etc. Helps UI validate workflows. No auth required. |
| `/api/audit/{request_id}` | GET | View request history | Manager, Approver | None | 200: `[{request_type, status_name, reason, updated_by_email, updated_at}]`<br>403: Unauthorized<br>404: Not found | request_updates, statuses, users | Shows request_updates for a reimbursement or advance. Supports MIS/audit trail (SRS). |
| `/api/reports/requests` | GET | Generate request summary | Approver | None | 200: `[{department_id, status_name, total_amount, count}]`<br>403: Unauthorized | reimbursement_requests, advance_requests, request_updates, users, departments | Query params: department_id, status, date_range. Aggregates for MIS (e.g., total Pending per department). |
